# Define the htpasswd-based users

apiVersion: user.openshift.io/v1
kind: User
metadata:
  name: user1
groups: null
identities:
- local-htpasswd:user1

--- 

apiVersion: user.openshift.io/v1
kind: User
metadata:
  name: user2
groups: null
identities:
- local-htpasswd:user2

--- 

apiVersion: user.openshift.io/v1
kind: User
metadata:
  name: acme-user1
groups: null
identities:
- local-htpasswd:acme-user1

---

# Establish the group membership for all users.

apiVersion: user.openshift.io/v1
kind: Group
metadata:
  name: tier-free-users
users: [bryonbaker, user1]

---

apiVersion: user.openshift.io/v1
kind: Group
metadata:
  name: tier-premium-users
users: [noyitz, user2]

---

apiVersion: user.openshift.io/v1
kind: Group
metadata:
  name: tier-enterprise-users
users: []

---

# Define groups for developers in Acme Inc
apiVersion: user.openshift.io/v1
kind: Group
metadata:
  name: tier-acme-dev-users
users: [bryonbaker, acme-user1, noyitz]

---

# Define groups for production users in Acme Inc.
apiVersion: user.openshift.io/v1
kind: Group
metadata:
  name: tier-acme-prod-users
users: [bryonbaker]

--- 

# Define the Cluster Role Bindings for the groups so they access the cluster to get the api key

apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: multi-user-view-access
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: view
subjects:
- apiGroup: rbac.authorization.k8s.io
  kind: User  
  name: user1
- apiGroup: rbac.authorization.k8s.io
  kind: User
  name: user2
- apiGroup: rbac.authorization.k8s.io
  kind: User
  name: acme-user1

---

apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: ingress-config-viewer
rules:
- apiGroups: ["config.openshift.io"]
  resources: ["ingresses"]
  verbs: ["get", "list"]

---

apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: ingress-config-viewer-user1
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: ingress-config-viewer
subjects:
- kind: User
  apiGroup: rbac.authorization.k8s.io
  name: user1
- kind: User
  apiGroup: rbac.authorization.k8s.io
  name: user2
- kind: User
  apiGroup: rbac.authorization.k8s.io
  name: acme-user1
